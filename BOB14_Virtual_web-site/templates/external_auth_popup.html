<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ provider_info.name }} 본인인증 - {{ provider_info.name }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-100">
    <div class="flex min-h-screen items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-md w-full space-y-8">
            <div>
                <div class="flex items-center justify-center">
                    <div class="w-16 h-16 {{ provider_info.color }} rounded-full flex items-center justify-center">
                        <span class="text-white text-2xl font-bold">{{ provider_info.logo }}</span>
                    </div>
                </div>
                <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
                    {{ provider_info.name }} 본인인증
                </h2>
                <p class="mt-2 text-center text-sm text-gray-600">
                    {{ provider_info.description }}을 통해 본인인증을 진행합니다
                </p>
            </div>
            
            <div class="bg-white py-8 px-6 shadow rounded-lg">
                <div class="bg-orange-50 border border-orange-200 rounded-md p-4 mb-6">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-orange-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-orange-800">
                                🚨 해킹 과정 시뮬레이션
                            </h3>
                            <div class="mt-2 text-sm text-orange-700">
                                <p>이 팝업창은 실제 해킹 사고의 단계를 시뮬레이션합니다:</p>
                                <p class="mt-1">1. 인증 토큰 생성</p>
                                <p class="mt-1">2. 팝업창 조작</p>
                                <p class="mt-1">3. 조작된 데이터 전송</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 해킹 단계 표시 -->
                <div class="mb-6 space-y-3">
                    <div id="step1" class="flex items-center p-3 bg-gray-100 rounded-lg">
                        <span class="w-6 h-6 bg-gray-300 text-white rounded-full flex items-center justify-center text-xs font-bold mr-3">1</span>
                        <span class="text-sm text-gray-600">인증 토큰 생성</span>
                    </div>
                    <div id="step2" class="flex items-center p-3 bg-gray-100 rounded-lg">
                        <span class="w-6 h-6 bg-gray-300 text-white rounded-full flex items-center justify-center text-xs font-bold mr-3">2</span>
                        <span class="text-sm text-gray-600">팝업창 조작</span>
                    </div>
                    <div id="step3" class="flex items-center p-3 bg-gray-100 rounded-lg">
                        <span class="w-6 h-6 bg-gray-300 text-white rounded-full flex items-center justify-center text-xs font-bold mr-3">3</span>
                        <span class="text-sm text-gray-600">조작된 데이터 전송</span>
                    </div>
                </div>
                
                <form id="authForm" class="space-y-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">
                            이름
                        </label>
                        <input type="text" name="name" id="name" required
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                               placeholder="박해커">
                    </div>
                    
                    <div>
                        <label for="resident_number" class="block text-sm font-medium text-gray-700">
                            주민등록번호
                        </label>
                        <input type="text" name="resident_number" id="resident_number" required
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                               placeholder="850515-9876543">
                    </div>
                    
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700">
                            휴대폰 번호
                        </label>
                        <input type="text" name="phone" id="phone" required
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                               placeholder="010-9876-5432">
                    </div>
                    
                    <div class="bg-red-50 border border-red-200 rounded-md p-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-red-800">
                                    해커 자신의 스마트폰 인증
                                </h3>
                                <div class="mt-2 text-sm text-red-700">
                                    <p>팝업창: 박해커 (해커 자신)</p>
                                    <p class="mt-1">실제로는 1단계 실명확인과 다른 정보이지만 인증이 성공합니다.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <button type="submit" 
                                class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            인증 완료
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        let authToken = null;
        
        // 페이지 로드 시 해킹 과정 시뮬레이션 시작
        window.addEventListener('load', function() {
            simulateHackingProcess();
        });
        
        // 해킹 과정 시뮬레이션
        async function simulateHackingProcess() {
            // 1단계: 인증 토큰 생성
            await activateStep('step1', '인증 토큰 생성 중...');
            try {
                const response = await fetch('/generate_auth_token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                const data = await response.json();
                authToken = data.token;
                console.log('생성된 인증 토큰:', authToken);
            } catch (error) {
                console.error('토큰 생성 실패:', error);
            }
            
            // 2단계: 팝업창 조작 (해커 자신의 정보 입력)
            await activateStep('step2', '팝업창 조작 중...');
            setTimeout(() => {
                // 시뮬레이션을 위해 해커 자신의 정보 자동 입력
                document.getElementById('name').value = '박해커';
                document.getElementById('resident_number').value = '850515-9876543';
                document.getElementById('phone').value = '010-9876-5432';
            }, 1000);
            
            // 3단계: 조작된 데이터 전송 준비
            await activateStep('step3', '조작된 데이터 전송 준비 완료');
        }
        
        // 단계 활성화
        function activateStep(stepId, message) {
            return new Promise((resolve) => {
                const step = document.getElementById(stepId);
                const stepNumber = step.querySelector('span');
                
                step.classList.add('active');
                stepNumber.classList.remove('bg-gray-300');
                stepNumber.classList.add('bg-green-500');
                
                console.log(message);
                
                setTimeout(resolve, 1500);
            });
        }
        
        // 폼 제출 처리
        document.getElementById('authForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            // 인증 토큰 추가
            if (authToken) {
                formData.append('auth_token', authToken);
            }
            
            // AJAX로 인증 데이터 전송
            fetch('/external_auth_process', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // 부모 창으로 메시지 전송 (실제로는 postMessage 사용)
                    if (window.opener) {
                        window.opener.location.href = data.redirect;
                    }
                    window.close();
                } else {
                    alert('인증 처리 중 오류가 발생했습니다.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('인증 처리 중 오류가 발생했습니다.');
            });
        });
    </script>
</body>
</html>
