<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>안심본인인증 - PASS - KT 알뜰폰 - 문자(SMS)로 인증</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
        <div class="text-center mb-6">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-red-600 font-bold text-2xl">P</span>
            </div>
            <h1 class="text-2xl font-bold text-gray-800">PASS</h1>
            <p class="text-gray-600 mt-2">인증을 넘어 일상으로 PASS</p>
        </div>

        <!-- 1단계: 입력정보 확인 -->
        <div id="step1" class="space-y-4">
            <h2 class="text-xl font-bold text-gray-800 mb-4">입력정보를 확인해 주세요</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">이름</label>
                    <input type="text" id="name" placeholder="이름을 입력하세요" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">주민등록번호</label>
                    <div class="flex items-center space-x-2">
                        <input type="text" id="rrn_front" placeholder="앞자리" maxlength="6" required
                               class="w-24 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                        <span class="text-gray-400">-</span>
                        <div class="flex items-center space-x-1">
                            <input type="text" id="rrn_back_first" placeholder="1" maxlength="1" required
                                   class="w-8 h-10 px-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-center">
                            <div class="w-8 h-10 px-2 border border-gray-300 rounded-md bg-gray-50 flex items-center justify-center text-gray-400">•</div>
                            <div class="w-8 h-10 px-2 border border-gray-300 rounded-md bg-gray-50 flex items-center justify-center text-gray-400">•</div>
                            <div class="w-8 h-10 px-2 border border-gray-300 rounded-md bg-gray-50 flex items-center justify-center text-gray-400">•</div>
                            <div class="w-8 h-10 px-2 border border-gray-300 rounded-md bg-gray-50 flex items-center justify-center text-gray-400">•</div>
                            <div class="w-8 h-10 px-2 border border-gray-300 rounded-md bg-gray-50 flex items-center justify-center text-gray-400">•</div>
                            <div class="w-8 h-10 px-2 border border-gray-300 rounded-md bg-gray-50 flex items-center justify-center text-gray-400">•</div>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">휴대폰 번호</label>
                    <input type="text" id="phone" placeholder="휴대폰 번호를 입력하세요" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">보안 문자</label>
                    <div class="flex items-center space-x-2">
                        <div id="captchaDisplay" class="flex-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-50 text-center font-mono text-lg">
                        </div>
                        <button type="button" onclick="refreshCaptcha()" class="px-3 py-2 text-gray-500 hover:text-gray-700">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                        </button>
                        <button type="button" class="px-3 py-2 text-gray-500 hover:text-gray-700">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>
                            </svg>
                        </button>
                    </div>
                    <input type="text" id="captcha" placeholder="보안문자를 입력하세요" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 mt-2">
                </div>
            </div>

            <button type="button" onclick="confirmInfo()" 
                    class="w-full px-4 py-3 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 font-medium">
                확인
            </button>
        </div>

        <!-- 2단계: 인증번호 입력 -->
        <div id="step2" class="hidden space-y-4">
            <h2 class="text-xl font-bold text-gray-800 mb-4">보내드린 인증번호 6자리를 입력해 주세요</h2>
            
            <div class="space-y-4">
                <div class="flex items-center space-x-2">
                    <input type="text" id="authCode" placeholder="인증번호" maxlength="6" required
                           class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 text-center text-lg font-mono">
                    <button type="button" onclick="verifyCode()" 
                            class="px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                        확인
                    </button>
                </div>

                <div class="flex items-center justify-between text-sm text-gray-600">
                    <div class="flex items-center space-x-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span id="timer">2:52</span>
                    </div>
                    <button type="button" onclick="extendTime()" class="text-red-600 hover:text-red-700">
                        시간연장
                    </button>
                </div>
            </div>
        </div>

        <!-- 3단계: 인증 완료 -->
        <div id="step3" class="hidden space-y-4">
            <div class="text-center">
                <div id="resultContent" class="text-sm text-gray-600"></div>
            </div>
        </div>

        <!-- 하단 정보 -->
        <div class="mt-8 pt-4 border-t border-gray-200 text-xs text-gray-500 text-center">
            <div class="space-y-1">
                <div class="flex justify-center space-x-4">
                    <a href="#" class="hover:text-gray-700">이용약관</a>
                    <a href="#" class="hover:text-gray-700">개인정보처리방침</a>
                    <a href="#" class="hover:text-gray-700">API 도입문의</a>
                </div>
                <p>VeriSign 256-bit SSL 암호화 적용</p>
                <div class="flex items-center justify-center space-x-2">
                    <span>NICE평가정보</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // URL 파라미터에서 값 가져오기
        const urlParams = new URLSearchParams(window.location.search);
        const requestId = urlParams.get('request_id');
        const state = urlParams.get('state');
        const originalNonce = urlParams.get('nonce'); // 서버에서 받은 nonce
        
        console.log('URL 파라미터:', {
            requestId: requestId,
            state: state,
            originalNonce: originalNonce
        });

        let timerInterval;
        let timeLeft = 172; // 2분 52초

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            refreshCaptcha(); // 보안문자 초기 생성
        });

        // 타이머 업데이트
        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                alert('인증 시간이 만료되었습니다.');
                window.close();
            }
            timeLeft--;
        }

        // 시간 연장
        function extendTime() {
            timeLeft = 172;
            updateTimer();
        }

        // 1단계: 입력정보 확인
        function confirmInfo() {
            const name = document.getElementById('name').value;
            const rrnFront = document.getElementById('rrn_front').value;
            const rrnBackFirst = document.getElementById('rrn_back_first').value;
            const phone = document.getElementById('phone').value;
            const captcha = document.getElementById('captcha').value;
            
            if (!name || !rrnFront || !rrnBackFirst || !phone || !captcha) {
                alert('모든 필드를 입력해주세요.');
                return;
            }

            if (rrnFront.length !== 6) {
                alert('주민등록번호 앞자리는 6자리여야 합니다.');
                return;
            }

            if (!rrnBackFirst || rrnBackFirst.length !== 1) {
                alert('주민등록번호 뒷자리 첫 번째 숫자를 입력해주세요.');
                return;
            }

            if (captcha !== document.getElementById('captchaDisplay').textContent) {
                alert('보안문자를 정확히 입력해주세요.');
                return;
            }

            // 2단계로 이동
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.remove('hidden');
            
            // 타이머 시작
            timerInterval = setInterval(updateTimer, 1000);
            updateTimer();
        }

        // 2단계: 인증번호 확인
        function verifyCode() {
            const authCode = document.getElementById('authCode').value;
            const name = document.getElementById('name').value;
            const rrnFront = document.getElementById('rrn_front').value;
            const rrnBackFirst = document.getElementById('rrn_back_first').value;
            
            if (!authCode || authCode.length !== 6) {
                alert('인증번호 6자리를 입력해주세요.');
                return;
            }

            clearInterval(timerInterval);

            // 3단계로 이동 (로딩 상태로)
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.remove('hidden');
            
            // 로딩 상태 표시
            const resultContent = document.getElementById('resultContent');
            resultContent.innerHTML = `
                <div class="text-center">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-blue-600 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                    </div>
                    <p class="font-medium">본인인증 처리 중...</p>
                    <p class="text-sm mt-1 text-gray-600">잠시만 기다려주세요.</p>
                </div>
            `;
            
            // 토큰 전송 후 결과에 따라 UI 업데이트
            sendToken(name, rrnFront, rrnBackFirst);
        }

        // 토큰 전송
        async function sendToken(name, rrnFront, rrnBackFirst) {
            try {
                console.log('전송할 데이터:', {
                    name: name,
                    rrn: `${rrnFront}-${rrnBackFirst}000000`,
                    nonce: originalNonce,
                    request_id: requestId,
                    state: state
                });
                
                const response = await fetch('/mock_idp_token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        rrn: `${rrnFront}-${rrnBackFirst}000000`,
                        nonce: originalNonce || generateNonce(), // nonce가 없으면 새로 생성
                        request_id: requestId,
                        state: state
                    })
                });

                if (response.ok) {
                    console.log('토큰 전송 성공');
                    const result = await response.json();
                    
                    // 성공 페이지 표시
                    const resultContent = document.getElementById('resultContent');
                    resultContent.innerHTML = `
                        <div class="text-green-800">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                            <p class="font-medium text-center">✅ 본인인증 성공!</p>
                            <p class="text-sm mt-2 text-center"><strong>인증된 사용자:</strong> ${name}</p>
                            <p class="text-sm mt-3 text-center text-gray-600">본인인증이 완료되었습니다.</p>
                        </div>
                    `;
                    
                    // step2/callback 호출
                    try {
                        console.log('step2/callback 호출 중...');
                        const callbackResponse = await fetch('/step2/callback', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                request_id: requestId,
                                state: state,
                                idp_signed_token: result.idp_signed_token
                            })
                        });
                        
                        const callbackResult = await callbackResponse.json();
                        console.log('step2/callback 결과:', callbackResult);
                        
                        if (callbackResponse.ok) {
                            console.log('step2/callback 성공');
                            
                            // 최종 완료 API 호출 (자동으로 개통 완료)
                            try {
                                console.log('최종 완료 API 호출 중...');
                                const finalizeResponse = await fetch('/finalize', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({ 
                                        sid: callbackResult.sid || requestId 
                                    })
                                });
                                
                                const finalizeResult = await finalizeResponse.json();
                                console.log('최종 완료 결과:', finalizeResult);
                                
                                if (finalizeResponse.ok) {
                                    console.log('최종 완료 성공 - 개통 완료!');
                                    
                                    // 부모 창에 성공 메시지 전달 (개통 완료 포함)
                                    if (window.opener) {
                                        window.opener.postMessage({
                                            type: 'CONTRACT_COMPLETE',
                                            data: finalizeResult,
                                            success: true
                                        }, '*');
                                    }
                                    
                                    // 성공 메시지 표시
                                    const resultContent = document.getElementById('resultContent');
                                    resultContent.innerHTML = `
                                        <div class="text-green-800">
                                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                                <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                            </div>
                                            <p class="font-medium text-center">🎉 개통 완료!</p>
                                            <p class="text-sm mt-2 text-center">본인인증이 성공적으로 완료되어</p>
                                            <p class="text-sm mt-1 text-center">휴대폰 개통이 완료되었습니다.</p>
                                            <p class="text-sm mt-3 text-center text-gray-600">개통 완료 페이지로 이동합니다...</p>
                                        </div>
                                    `;
                                    
                                    // 3초 후 개통 완료 페이지로 리다이렉트
                                    setTimeout(() => {
                                        if (finalizeResult.redirect_url) {
                                            window.location.href = finalizeResult.redirect_url;
                                        } else {
                                            window.close();
                                        }
                                    }, 3000);
                                    
                                } else {
                                    console.error('최종 완료 실패:', finalizeResult);
                                    
                                    // 부모 창에 실패 메시지 전달
                                    if (window.opener) {
                                        window.opener.postMessage({
                                            type: 'CONTRACT_FAILURE',
                                            error: finalizeResult.error,
                                            message: finalizeResult.message || '최종 완료 중 오류가 발생했습니다.'
                                        }, '*');
                                    }
                                    
                                    // 실패 메시지 표시
                                    const resultContent = document.getElementById('resultContent');
                                    resultContent.innerHTML = `
                                        <div class="text-red-800">
                                            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                                <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                </svg>
                                            </div>
                                            <p class="font-medium text-center">❌ 개통 실패!</p>
                                            <p class="text-sm mt-2 text-center">최종 완료 중 오류가 발생했습니다.</p>
                                            <p class="text-sm mt-3 text-center text-gray-600">이 창은 자동으로 닫힙니다.</p>
                                        </div>
                                    `;
                                    
                                    // 5초 후 창 닫기
                                    setTimeout(() => {
                                        window.close();
                                    }, 5000);
                                }
                                
                            } catch (finalizeError) {
                                console.error('최종 완료 API 오류:', finalizeError);
                                
                                // 부모 창에 오류 메시지 전달
                                if (window.opener) {
                                    window.opener.postMessage({
                                        type: 'CONTRACT_FAILURE',
                                        error: 'NETWORK_ERROR',
                                        message: '네트워크 오류로 인해 개통을 완료할 수 없습니다.'
                                    }, '*');
                                }
                                
                                // 오류 메시지 표시
                                const resultContent = document.getElementById('resultContent');
                                resultContent.innerHTML = `
                                    <div class="text-red-800">
                                        <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </div>
                                        <p class="font-medium text-center">❌ 네트워크 오류!</p>
                                        <p class="text-sm mt-2 text-center">개통 완료 중 네트워크 오류가 발생했습니다.</p>
                                        <p class="text-sm mt-3 text-center text-gray-600">이 창은 자동으로 닫힙니다.</p>
                                    </div>
                                `;
                                
                                // 5초 후 창 닫기
                                setTimeout(() => {
                                    window.close();
                                }, 5000);
                            }
                        } else {
                            console.error('step2/callback 실패:', callbackResult);
                            
                            // 사용자 일치성 검증 실패 처리
                            if (callbackResult.error === 'USER_MISMATCH') {
                                const resultContent = document.getElementById('resultContent');
                                resultContent.innerHTML = `
                                    <div class="text-red-800">
                                        <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </div>
                                        <p class="font-medium text-center">❌ 본인인증 실패!</p>
                                        <p class="text-sm mt-2 text-center"><strong>사용자 불일치 오류</strong></p>
                                        <p class="text-sm mt-2 text-center">1단계와 2단계 인증자가 일치하지 않습니다.</p>
                                        <p class="text-sm mt-3 text-center text-gray-600">본인인증이 실패했습니다.</p>
                                    </div>
                                `;
                                
                                // 부모 창에 실패 메시지 전달
                                if (window.opener) {
                                    window.opener.postMessage({
                                        type: 'AUTH_FAILURE',
                                        error: 'USER_MISMATCH',
                                        message: callbackResult.message
                                    }, '*');
                                }
                                
                                // 5초 후 창 닫기
                                setTimeout(() => {
                                    window.close();
                                }, 5000);
                                return;
                            }
                        }
                    } catch (callbackError) {
                        console.error('step2/callback 오류:', callbackError);
                    }
                    
                    // 3초 후 창 닫기
                    setTimeout(() => {
                        window.close();
                    }, 3000);
                } else {
                    console.error('토큰 전송 실패');
                    const errorData = await response.json();
                    
                    // 실패 페이지로 변경 (성공 아이콘과 완료 텍스트 제거)
                    const resultContent = document.getElementById('resultContent');
                    resultContent.innerHTML = `
                        <div class="text-red-800">
                            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </div>
                            <p class="font-medium text-center">❌ 본인인증 실패!</p>
                            <p class="text-sm mt-2 text-center">사용자 정보가 일치하지 않습니다.</p>
                            <p class="text-sm mt-3 text-center text-gray-600">이 창은 자동으로 닫힙니다.</p>
                        </div>
                    `;
                    
                    // 5초 후 창 닫기
                    setTimeout(() => {
                        window.close();
                    }, 5000);
                }
            } catch (error) {
                console.error('토큰 전송 오류:', error);
                
                // 오류 페이지로 변경 (성공 아이콘과 완료 텍스트 제거)
                const resultContent = document.getElementById('resultContent');
                resultContent.innerHTML = `
                    <div class="text-red-800">
                        <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </div>
                        <p class="font-medium text-center">❌ 본인인증 실패!</p>
                        <p class="text-sm mt-2 text-center">네트워크 오류가 발생했습니다.</p>
                        <p class="text-sm mt-3 text-center text-gray-600">이 창은 자동으로 닫힙니다.</p>
                    </div>
                `;
                
                // 5초 후 창 닫기
                setTimeout(() => {
                    window.close();
                }, 5000);
            }
        }

        // Nonce 생성 함수
        function generateNonce() {
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < 24; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // 6자리 보안문자 생성 함수
        function generateCaptcha() {
            const digits = '0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += digits.charAt(Math.floor(Math.random() * digits.length));
            }
            return result;
        }

        // 보안문자 새로고침 함수
        function refreshCaptcha() {
            const captchaDisplay = document.getElementById('captchaDisplay');
            const newCaptcha = generateCaptcha();
            captchaDisplay.textContent = newCaptcha;
            document.getElementById('captcha').value = ''; // 입력 필드 초기화
        }

        // Enter 키로 인증번호 입력
        document.getElementById('authCode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                verifyCode();
            }
        });

        // 보안문자 Enter 키 처리
        document.getElementById('captcha').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                confirmInfo();
            }
        });

        // 주민등록번호 앞자리 숫자만 입력
        document.getElementById('rrn_front').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
        });

        // 주민등록번호 뒷자리 첫 번째 숫자만 입력
        document.getElementById('rrn_back_first').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
        });

        // 휴대폰 번호 숫자만 입력
        document.getElementById('phone').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
        });

        // 페이지 로드 시 보안문자 생성
        document.addEventListener('DOMContentLoaded', function() {
            refreshCaptcha(); // 초기 보안문자 생성
        });
    </script>
</body>
</html>
